2026-01-17 23:27:58,903 [INFO] Log file: /Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/tests/logs/ap-gov__20260118T042758Z.log
2026-01-17 23:27:58,904 [INFO] Environment status: {
  "gemini_api_key_set": true,
  "wolfram_app_id_set": true,
  "tokenc_api_key_set": true
}
2026-01-17 23:27:58,932 [INFO] Repo root: /Users/karthiksing05/Documents/Independent-Projects/NexHacks2026
2026-01-17 23:27:58,932 [INFO] ai-util root: /Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util
2026-01-17 23:27:58,932 [INFO] Sophia module dir: /Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sophia
2026-01-17 23:27:58,932 [INFO] Selected class dir: /Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sample_classes/ap-gov
2026-01-17 23:27:58,932 [INFO] Class type: non-math (wolfram disabled)
2026-01-17 23:27:58,932 [INFO] syllabus.pdf: /Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sample_classes/ap-gov/syllabus.pdf
2026-01-17 23:27:58,932 [INFO] practice PDFs: 1
2026-01-17 23:27:58,932 [INFO]  - ap_government_practice_exam_by_max_score.pdf
2026-01-17 23:27:58,932 [INFO] Artifacts dir: /Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/tests/logs/ap-gov__artifacts
2026-01-17 23:27:58,932 [INFO] Parsing syllabus PDF...
2026-01-17 23:28:02,447 [INFO] Parsing syllabus PDF FAILED: Gemini HTTPError 503: {
  "error": {
    "code": 503,
    "message": "The model is overloaded. Please try again later.",
    "status": "UNAVAILABLE"
  }
}

2026-01-17 23:28:02,452 [INFO] Traceback:
Traceback (most recent call last):
  File "/Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sophia/sophia_ai.py", line 387, in generate_json
    with urllib.request.urlopen(req, timeout=self.timeout_s) as resp:
         ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/urllib/request.py", line 495, in open
    response = meth(req, response)
  File "/opt/anaconda3/lib/python3.13/urllib/request.py", line 604, in http_response
    response = self.parent.error(
        'http', request, response, code, msg, hdrs)
  File "/opt/anaconda3/lib/python3.13/urllib/request.py", line 533, in error
    return self._call_chain(*args)
           ~~~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/anaconda3/lib/python3.13/urllib/request.py", line 613, in http_error_default
    raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 503: Service Unavailable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/tests/test_utils.py", line 163, in run_step
    val = fn()
  File "/Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/tests/test_utils.py", line 173, in <lambda>
    fn=lambda: ai.parse_syllabus_pdf(
               ~~~~~~~~~~~~~~~~~~~~~^
        syllabus_pdf_path=str(syllabus_pdf),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        save_text_path=str(syllabus_text_path),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        max_pages=max_pages,
        ^^^^^^^^^^^^^^^^^^^^
    ),
    ^
  File "/Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sophia/sophia_ai.py", line 1272, in parse_syllabus_pdf
    text = self.file_utils.extract_syllabus_outline(
        pdf_path=syllabus_pdf_path,
        gemini_client=self.gemini,
        max_pages=max_pages,
    )
  File "/Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sophia/file_utils.py", line 91, in extract_syllabus_outline
    return self._format_syllabus_with_gemini(extracted, gemini_client=gemini_client)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sophia/file_utils.py", line 456, in _format_syllabus_with_gemini
    out = gemini_client.generate_json(
        system_instruction=system_instruction,
    ...<3 lines>...
        max_output_tokens=8192,
    )
  File "/Users/karthiksing05/Documents/Independent-Projects/NexHacks2026/ai-util/sophia/sophia_ai.py", line 423, in generate_json
    raise RuntimeError(f"Gemini HTTPError {e.code}: {body}") from e
RuntimeError: Gemini HTTPError 503: {
  "error": {
    "code": 503,
    "message": "The model is overloaded. Please try again later.",
    "status": "UNAVAILABLE"
  }
}


2026-01-17 23:28:02,452 [INFO] Syllabus extracted chars: 0
2026-01-17 23:28:02,452 [INFO] Parsing practice PDFs...
